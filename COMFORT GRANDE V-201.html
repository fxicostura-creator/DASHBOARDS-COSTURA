<!DOCTYPE html>
<html>
<head>
    <title>COMFORT GRANDE</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #0a4c79fd;
            color: #333;
            text-align: center;
            padding: 20px;
        }

        h1 {
            color: rgb(255, 255, 255);
            margin-bottom: 20px;
        }

        .rate-cards {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .card {
            background-color: rgb(255, 255, 255);
            border-radius: 10px;
            padding: 15px 20px;
            box-shadow: 0px 4px 10px rgba(0,0,0,0.1);
            width: 140px;
            flex-shrink: 0;
        }

        .label {
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .value {
            font-size: 26px;
            color: #007acc;
        }

        .dashboard {
            display: flex;
            gap: 30px;
            justify-content: center;
            align-items: flex-start;
        }

        .data-columns {
            display: flex;
            flex-direction: column;
            gap: 30px;
            width: 360px;
        }

        .column {
            background: white;
            border-radius: 10px;
            padding: 15px 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .column h2 {
            color: #161468;
            font-size: 18px;
            margin-bottom: 15px;
            border-bottom: 2px solid #007acc;
            padding-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .rate-small {
            font-size: 14px;
            color: #007acc;
            font-weight: normal;
            margin-left: 10px;
        }

        .counter-card {
            margin: 12px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 14px;
            border-radius: 6px;
            background-color: #f0f7ff;
            box-shadow: inset 1px 1px 3px #d0e4ff;
        }

        .counter-label {
            font-weight: bold;
            color: #003d7a;
            font-size: 16px;
        }

        .counter {
            font-size: 20px;
            color: #007acc;
            font-weight: bold;
        }

        .chart-column {
            background: rgb(255, 255, 255);
            border-radius: 10px;
            padding: 45px;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            width: 400px;
            height: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .chart-column h2 {
            color: #161468;
            font-size: 18px;
            margin-bottom: 10px;
            border-bottom: 2px solid #007acc;
            padding-bottom: 5px;
            width: 100%;
            text-align: center;
        }

        .chart-detalle-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
            margin-top: 40px;
            width: 90%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }

        canvas#graficaDetalle, canvas#grafica {
            width: 100% !important;
            height: 400px !important;
        }
    </style>
</head>
<body>
    <header style="position: relative; margin-bottom: 30px;">
        <h1 style="color: white; margin: 0; display: inline-block;">COMFORT GRANDE V-201</h1>
        <img src="https://images.squarespace-cdn.com/content/v1/620ed8b50c43390f3c3413d1/141af9c3-5706-4d16-9741-a72963d22d07/main_logo_white_s.png?format=1500w" alt="Logo Empresa" style="position: absolute; top: 0; right: 0; height: 80px;"/>
    </header>

    <div class="rate-cards">
        <div class="card">
            <div class="label">Rate Total</div>
            <div class="value" id="rate">648</div>
        </div>
        <div class="card">
            <div class="label">Piezas Buenas</div>
            <div class="value" id="goodCount">0</div>
        </div>
        <div class="card">
            <div class="label">Eficiencia</div>
            <div class="value" id="efficiency">0%</div>
        </div>
    </div>

    <div class="dashboard">
        <div class="data-columns">
            <div class="column" id="celda5-column">
                <h2>CELDA 5 <span class="rate-small">(Rate: 324 | Total: <span id="total5">0</span>)</span></h2>
                <div class="counter-card"><div class="counter-label">OP13A</div><div class="counter" id="op13a_5">0</div></div>
                <div class="counter-card"><div class="counter-label">OP13B</div><div class="counter" id="op13b_5">0</div></div>
                <div class="counter-card"><div class="counter-label">OP13C</div><div class="counter" id="op13c_5">0</div></div>
            </div>
            <div class="column" id="celda9-column">
                <h2>CELDA 9 <span class="rate-small">(Rate: 324 | Total: <span id="total9">0</span>)</span></h2>
                <div class="counter-card"><div class="counter-label">OP13A</div><div class="counter" id="op13a_9">0</div></div>
                <div class="counter-card"><div class="counter-label">OP13B</div><div class="counter" id="op13b_9">0</div></div>
                <div class="counter-card"><div class="counter-label">OP13C</div><div class="counter" id="op13c_9">0</div></div>
            </div>
        </div>

        <div class="chart-column">
            <h2>Producción Total: CELDA 5 vs CELDA 9</h2>
            <canvas id="grafica"></canvas>
        </div>
    </div>

    <div class="chart-detalle-container">
        <h2>Detalle por Operación</h2>
        <canvas id="graficaDetalle"></canvas>
    </div>

    <script>
        const url = "https://script.google.com/macros/s/AKfycbwY5pS2dXJ90vdyDfRxf8k1HZ_u8m9kYt0mBpRVfllo6PnkzPPRGIPXvGDrIhI57S4a/exec";
        const rateCelda5 = 324;
        const rateCelda9 = 324;
        const rateTotal = rateCelda5 + rateCelda9;

        const historyLabels = [];
        const celda5Totales = [], celda9Totales = [];
        const op13a_5_Data = [], op13b_5_Data = [], op13c_5_Data = [];
        const op13a_9_Data = [], op13b_9_Data = [], op13c_9_Data = [];

        const ctxResumen = document.getElementById("grafica").getContext("2d");
        
        function createGradient(ctx, colorStart, colorEnd) {
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, colorStart);
            gradient.addColorStop(1, colorEnd);
            return gradient;
        }

        const chartResumen = new Chart(ctxResumen, {
            type: "line",
            data: {
                labels: historyLabels,
                datasets: [
                    {
                        label: "CELDA 5",
                        data: celda5Totales,
                        borderColor: "#007acc",
                        backgroundColor: createGradient(ctxResumen, "rgba(0,122,204,0.35)", "rgba(0,122,204,0)"),
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: "CELDA 9",
                        data: celda9Totales,
                        borderColor: "#f39c12",
                        backgroundColor: createGradient(ctxResumen, "rgba(243,156,18,0.35)", "rgba(243,156,18,0)"),
                        fill: true,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true } }
            }
        });


        const chartDetalle = new Chart(document.getElementById("graficaDetalle"), {
            type: "line",
            data: {
                labels: historyLabels,
                datasets: [
                    { label: "C5 OP13A", data: op13a_5_Data, borderColor: "red", fill: false },
                    { label: "C5 OP13B", data: op13b_5_Data, borderColor: "green", fill: false },
                    { label: "C5 OP13C", data: op13c_5_Data, borderColor: "blue", fill: false },
                    { label: "C9 OP13A", data: op13a_9_Data, borderColor: "orange", fill: false },
                    { label: "C9 OP13B", data: op13b_9_Data, borderColor: "purple", fill: false },
                    { label: "C9 OP13C", data: op13c_9_Data, borderColor: "brown", fill: false }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true } }
            }
        });

        async function actualizarDatos() {
            try {
                const response = await fetch(url);
                const data = await response.json();

                let total5 = 0;
                let total9 = 0;

                // Actualizar contadores individuales
                document.getElementById("op13a_5").textContent = data.celda5.op13a.total;
                document.getElementById("op13b_5").textContent = data.celda5.op13b.total;
                document.getElementById("op13c_5").textContent = data.celda5.op13c.total;
                document.getElementById("op13a_9").textContent = data.celda9.op13a.total;
                document.getElementById("op13b_9").textContent = data.celda9.op13b.total;
                document.getElementById("op13c_9").textContent = data.celda9.op13c.total;
                
                // Calcular totales de cada celda y el total general
                total5 = data.celda5.op13a.total + data.celda5.op13b.total + data.celda5.op13c.total;
                total9 = data.celda9.op13a.total + data.celda9.op13b.total + data.celda9.op13c.total;
                
                const totalGeneral = total5 + total9;

                // Actualizar valores de los totales
                document.getElementById("total5").textContent = total5;
                document.getElementById("total9").textContent = total9;
                document.getElementById("goodCount").textContent = totalGeneral;

                // Actualizar eficiencia
                document.getElementById("efficiency").textContent = ((totalGeneral / rateTotal) * 100).toFixed(1) + "%";
                
                // Actualizar gráficos
                const now = new Date().toLocaleTimeString();
                historyLabels.push(now);
                celda5Totales.push(total5);
                celda9Totales.push(total9);
                op13a_5_Data.push(data.celda5.op13a.total);
                op13b_5_Data.push(data.celda5.op13b.total);
                op13c_5_Data.push(data.celda5.op13c.total);
                op13a_9_Data.push(data.celda9.op13a.total);
                op13b_9_Data.push(data.celda9.op13b.total);
                op13c_9_Data.push(data.celda9.op13c.total);

                if (historyLabels.length > 20) {
                    historyLabels.shift();
                    celda5Totales.shift();
                    celda9Totales.shift();
                    op13a_5_Data.shift();
                    op13b_5_Data.shift();
                    op13c_5_Data.shift();
                    op13a_9_Data.shift();
                    op13b_9_Data.shift();
                    op13c_9_Data.shift();
                }

                chartResumen.update();
                chartDetalle.update();

            } catch (error) {
                console.error("Error al obtener datos:", error);
            }
        }
        
        // Actualizar datos cada 5 segundos
        setInterval(actualizarDatos, 5000);
        actualizarDatos(); // Llamar de inmediato al cargar la página
    </script>
</body>
</html>
