<!DOCTYPE html>
<html>
<head>
    <title>CUT & SEW </title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /*  Estilos Generales y Modo Claro Profesional */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #F8F9FA; /* Fondo blanco muy suave */
            color: #343A40; /* Texto oscuro */
            text-align: center;
            padding: 25px;
        }
        h1 {
            color: #22698d; /* Azul brillante como color principal */
            margin-bottom: 25px;
            font-size: 2.2em;
            letter-spacing: 0.5px;
        }

        /*  Contenedor Principal de M茅tricas */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 columnas iguales */
            gap: 20px;
            max-width: 900px;
            margin: 0px auto 20px auto;
        }
        .metric-card {
            background-color: #FFFFFF; /* Fondo de tarjeta blanco puro */
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0px 4px 15px rgba(0,0,0,0.1); /* Sombra muy suave */
            border-top: 3px solid #17A2B8; /* Borde superior de acento (cian suave) */
        }
        .label {
            font-size: 15px;
            font-weight: 500;
            color: #6C757D; /* Gris medio para las etiquetas */
            margin-bottom: 5px;
        }
        .value {
            font-size: 32px;
            color: #17A2B8; /* Color de acento cian suave */
            font-weight: bold;
        }

        /*  Barra de Progreso (Big Progress Bar) */
        .progress-container {
            margin: 40px auto 10px auto;
            width: 90%;
            height: 38px;
            background-color: #E9ECEF; /* Fondo gris claro de la barra */
            border-radius: 20px;
            overflow: hidden;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
        }
        .progress-fill {
            height: 100%;
            width: 0%;
            /* El color inicial lo maneja el JS, aqu铆 solo la transici贸n */
            transition: width 0.6s ease-in-out, background-color 0.3s ease;
            border-radius: 20px;
        }
        .progress-label {
            font-size: 16px;
            font-weight: 600;
            margin-top: 5px;
            color: #343A40; /* Texto oscuro para el modo claro */
        }

        /*  Contenedor de Detalle (Totales por Operaci贸n) */
        .detail-container {
            background: #FFFFFF;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            margin: 40px auto 20px auto;
            border: 1px solid #DEE2E6; /* Borde muy sutil */
        }
        .detail-container h2 {
            color: #16849d;
            font-size: 20px;
            margin-bottom: 20px;
            border-bottom: 2px solid #17A2B8;
            padding-bottom: 10px;
            text-transform: uppercase;
        }
        .counter-card {
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            border-radius: 8px;
            background-color: #F8F9FA; /* Fondo muy claro para las filas de conteo */
            border-left: 4px solid #378398; /* Acento visual azul */
        }
        .counter-label {
            font-weight: 600;
            color: #495057;
            font-size: 16px;
        }
        .counter {
            font-size: 22px;
            color: #1d8d9f;
            font-weight: 700;
        }
    </style>
</head>
<body>

<h1>ENGAGE</h1>

<div class="metrics-grid">
    <div class="metric-card">
        <div class="label">Meta (Rate)</div>
        <div class="value" id="rate">---</div>
    </div>
    <div class="metric-card">
        <div class="label">Piezas Buenas</div>
        <div class="value" id="goodCount">0</div>
    </div>
    <div class="metric-card">
        <div class="label">Eficiencia Actual</div>
        <div class="value" id="efficiency">0%</div>
    </div>
</div>

<div class="progress-container">
    <div id="progressFill" class="progress-fill"></div>
</div>
<div class="progress-label" id="progressMetaText">
    Avance vs meta (cargando...)
</div>

<div class="detail-container">
    <h2>Total Producido: <span id="total9">0</span></h2>
    <div class="counter-card"><div class="counter-label">OP13A </div><div class="counter" id="op13a_9">0</div></div>
    <div class="counter-card"><div class="counter-label">OP13B </div><div class="counter" id="op13b_9">0</div></div>
    <div class="counter-card"><div class="counter-label">OP13C </div><div class="counter" id="op13c_9">0</div></div>
</div>

<script>
    // **NOTA:** El c贸digo JavaScript se mantiene EXACTAMENTE igual para preservar la funcionalidad.

    // API de producci贸n
    const url = "https://script.google.com/macros/s/AKfycbwY5pS2dXJ90vdyDfRxf8k1HZ_u8m9kYt0mBpRVfllo6PnkzPPRGIPXvGDrIhI57S4a/exec";

    //  API de metas desde Google Sheets
    const metasUrl = "https://script.google.com/macros/s/AKfycbyEXGaVrVWo6ppY-vdeEu33wZrq7Fq2xW75FRF9xGASRq2nrYEaSR93evV9ym6g-K8h/exec";

    // Meta din谩mica con fallback
    let rate9 = 324;
    let metaCargada = false;

    async function cargarMeta() {
        try {
            const r = await fetch(metasUrl);
            const metaData = await r.json();
            let nuevaMeta = null;

            if (metaData.celda9 && metaData.celda9.meta != null) {
                nuevaMeta = metaData.celda9.meta;
            } else if (metaData.meta != null) {
                nuevaMeta = metaData.meta;
            }

            if (nuevaMeta != null) rate9 = Number(nuevaMeta);

        } catch (e) {
            console.log("Error al cargar meta, usando fallback:", e);
        }

        metaCargada = true;
        document.getElementById("rate").textContent = rate9;
        document.getElementById("progressMetaText").textContent =
            "Avance vs meta (" + rate9 + " pzas)";
    }

    async function actualizar() {
        try {
            const r = await fetch(url);
            const d = await r.json();

            document.getElementById("op13a_9").textContent = d.celda9.op13a.total;
            document.getElementById("op13b_9").textContent = d.celda9.op13b.total;
            document.getElementById("op13c_9").textContent = d.celda9.op13c.total;

            const total9 = d.celda9.op13a.total + d.celda9.op13b.total + d.celda9.op13c.total;
            document.getElementById("total9").textContent = total9;
            document.getElementById("goodCount").textContent = total9;

            const eff = (total9 / rate9) * 100;
            document.getElementById("efficiency").textContent = eff.toFixed(1) + "%";

            const fill = document.getElementById("progressFill");
            fill.style.width = Math.min(eff, 120) + "%";

            // Los colores de alerta (rojo, amarillo, verde) se mantienen, pero con un mejor contraste
            if (eff < 80) fill.style.backgroundColor = "#E74C3C"; // Rojo
            else if (eff < 95) fill.style.backgroundColor = "#F1C40F"; // Amarillo
            else fill.style.backgroundColor = "#2ECC71"; // Verde

        } catch (err) {
            console.log("Error al actualizar:", err);
        }
    }

    //  Cargar meta una vez y luego actualizar producci贸n
    cargarMeta();
    setInterval(actualizar, 5000);
    actualizar();
</script>

</body>
</html>
